<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AKIM.PRO ‚Äî –°–º–µ—Ç–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ü–£–¢–¨: –¢–µ–ø–µ—Ä—å –æ–Ω –≤–∏–¥–∏—Ç —Ç–≤–æ–π —Ñ–∞–π–ª data.js, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã —Å–æ–∑–¥–∞–ª -->
    <script src="data.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background: #000; color: #fff; -webkit-font-smoothing: antialiased; }
        .card { background: #111; border: 1px solid #222; border-radius: 20px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        input[type="number"] { background: #1a1a1a; border: 1px solid #333; color: #3b82f6; width: 80px; height: 50px; border-radius: 12px; text-align: center; font-weight: 900; outline: none; font-size: 18px; }
        input[type="text"] { background: #111; border: 1px solid #222; padding: 18px; border-radius: 15px; width: 100%; color: white; outline: none; font-weight: 700; }
        .sticky-result { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(15px); border-top: 1px solid #222; padding: 20px 20px 30px 20px; z-index: 50; }
        #photo-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); z-index: 100; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        #invoice-paper { background: white; color: #000; padding: 30px; width: 100%; max-width: 400px; border-radius: 2px; }
        .pdf-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .pdf-table th { text-align: left; font-size: 10px; border-bottom: 2px solid #000; padding: 5px; text-transform: uppercase; }
        .pdf-table td { font-size: 12px; padding: 10px 5px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body class="p-4 pb-56">

    <div class="max-w-md mx-auto">
        <!-- Header -->
        <div class="flex justify-between items-center mb-10 mt-4">
            <div>
                <h1 class="text-3xl font-black italic text-blue-500 uppercase leading-none">AKIM.PRO</h1>
                <p class="text-[10px] font-bold text-gray-500 tracking-[3px] mt-1 uppercase">Electric Specialist</p>
            </div>
            <div class="text-right">
                <p class="text-sm font-black text-blue-400">+996 755 000 228</p>
            </div>
        </div>

        <!-- –ü–æ–ª–µ –∏–º–µ–Ω–∏ -->
        <div class="mb-10">
            <label class="text-[10px] font-black text-gray-600 uppercase mb-2 block ml-1 tracking-widest">–û–±—ä–µ–∫—Ç / –ó–∞–∫–∞–∑—á–∏–∫</label>
            <input type="text" id="client_name" placeholder="–ù–∞–ø—Ä: —É–ª. –õ–µ–Ω–∏–Ω–∞ 45">
        </div>

        <!-- –°—é–¥–∞ –ø–æ–¥–≥—Ä—É–∑—è—Ç—Å—è —Ä–∞–±–æ—Ç—ã –∏–∑ data.js -->
        <div id="items_list"></div>
    </div>

    <!-- –ò—Ç–æ–≥–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="sticky-result">
        <div class="max-w-md mx-auto flex justify-between items-center">
            <div>
                <p class="text-[10px] font-black text-gray-500 uppercase mb-1">–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</p>
                <div class="text-4xl font-black italic text-blue-500 leading-none">
                    <span id="total_sum">0</span> <small class="text-xs not-italic text-white uppercase ml-1">—Å–æ–º</small>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="copyWhatsApp()" class="bg-green-600 w-14 h-14 rounded-2xl flex items-center justify-center active:scale-90 transition shadow-lg shadow-green-900/30">
                    <i class="fab fa-whatsapp text-2xl"></i>
                </button>
                <button onclick="generatePhoto()" class="bg-blue-600 px-6 h-14 rounded-2xl font-black text-[12px] uppercase active:scale-95 transition shadow-lg shadow-blue-900/30 tracking-wider">
                    –°–º–µ—Ç–∞ (–§–æ—Ç–æ)
                </button>
            </div>
        </div>
    </div>

    <!-- –û–≤–µ—Ä–ª–µ–π –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏ -->
    <div id="photo-overlay">
        <div id="image-result" class="mb-6 shadow-2xl border-4 border-white rounded-lg overflow-hidden max-h-[75vh]"></div>
        <p class="text-white text-[10px] font-black uppercase mb-8 text-center opacity-70 tracking-[2px]">–ó–∞–∂–º–∏ –ø–∞–ª—å—Ü–µ–º –Ω–∞ —Ñ–æ—Ç–æ,<br>—á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –≥–∞–ª–µ—Ä–µ—é</p>
        <button onclick="document.getElementById('photo-overlay').style.display='none'" class="bg-red-600 text-white px-12 py-4 rounded-full font-black text-xs uppercase tracking-widest shadow-xl">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <!-- –°–∫—Ä—ã—Ç—ã–π –º–∞–∫–µ—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–æ—Ç–æ -->
    <div style="position: absolute; left: -9999px;">
        <div id="invoice-paper">
            <div style="border-bottom: 5px solid #3b82f6; padding-bottom: 15px; margin-bottom: 25px;">
                <h2 style="margin: 0; font-size: 28px; font-weight: 900; color: #1e40af; font-style: italic; text-transform: uppercase;">AKIM.PRO</h2>
                <p style="margin: 5px 0 0 0; font-size: 11px; color: #666; text-transform: uppercase; letter-spacing: 2px; font-weight: bold;">–≠–ª–µ–∫—Ç—Ä–æ–º–æ–Ω—Ç–∞–∂–Ω—ã–µ —Ä–∞–±–æ—Ç—ã ‚Ä¢ –¢–∞–ª–∞—Å</p>
            </div>
            <div style="font-size: 12px; margin-bottom: 25px; line-height: 1.6;">
                <p style="margin: 0;"><strong>–ó–∞–∫–∞–∑—á–∏–∫:</strong> <span id="res_client"></span></p>
                <p style="margin: 0;"><strong>–ú–∞—Å—Ç–µ—Ä:</strong> +996 755 000 228</p>
                <p style="margin: 0;"><strong>–î–∞—Ç–∞:</strong> <span id="res_date"></span></p>
            </div>
            <table class="pdf-table">
                <thead>
                    <tr>
                        <th style="width: 60%">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç</th>
                        <th style="text-align: center; width: 15%">–ö–æ–ª</th>
                        <th style="text-align: right; width: 25%">–°—É–º–º–∞</th>
                    </tr>
                </thead>
                <tbody id="res_rows"></tbody>
            </table>
            <div style="margin-top: 40px; text-align: right;">
                <div style="display: inline-block; background: #3b82f6; color: white; padding: 20px 30px; border-radius: 8px; box-shadow: 0 4px 10px rgba(59,130,246,0.3);">
                    <p style="margin: 0; font-size: 10px; text-transform: uppercase; font-weight: 900; opacity: 0.9;">–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</p>
                    <h3 style="margin: 5px 0 0 0; font-size: 28px; font-weight: 900; font-style: italic;"><span id="res_total">0</span> –°–û–ú</h3>
                </div>
            </div>
            <div style="margin-top: 30px; text-align: center; font-size: 10px; color: #aaa; text-transform: uppercase; letter-spacing: 1px;">
                –ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –∑–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ!
            </div>
        </div>
    </div>

    <script>
        const itemsList = document.getElementById('items_list');
        const totalDisplay = document.getElementById('total_sum');

        // –ó–∞–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏
        function init() {
            if (typeof ESTIMATE_LIBRARY === 'undefined') {
                itemsList.innerHTML = `
                    <div class="p-8 border-2 border-dashed border-red-900 rounded-3xl text-center">
                        <p class="text-red-500 font-black uppercase text-xs">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã!</p>
                        <p class="text-gray-500 text-[10px] mt-2">–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª data.js –ª–µ–∂–∏—Ç –≤ –ø–∞–ø–∫–µ calc</p>
                    </div>
                `;
                return;
            }

            ESTIMATE_LIBRARY.forEach(cat => {
                let html = `<h3 class="text-[11px] font-black text-blue-500 uppercase mt-10 mb-4 ml-2 tracking-[3px]">${cat.category}</h3>`;
                cat.items.forEach(item => {
                    html += `
                        <div class="card shadow-md">
                            <div class="pr-3">
                                <p class="text-[14px] font-black uppercase leading-tight tracking-tight">${item.name}</p>
                                <p class="text-[11px] text-gray-500 font-bold mt-2 tracking-wide">${item.price} —Å–æ–º / –µ–¥.</p>
                            </div>
                            <input type="number" data-price="${item.price}" data-name="${item.name}" value="0" min="0" 
                                   class="qty-input" inputmode="numeric" oninput="updateTotal()">
                        </div>
                    `;
                });
                itemsList.innerHTML += html;
            });
        }

        function updateTotal() {
            let total = 0;
            document.querySelectorAll('.qty-input').forEach(input => {
                total += (parseInt(input.value) || 0) * parseInt(input.dataset.price);
            });
            totalDisplay.innerText = total.toLocaleString();
        }

        async function generatePhoto() {
            const client = document.getElementById('client_name').value || "–ù–µ —É–∫–∞–∑–∞–Ω";
            document.getElementById('res_client').innerText = client;
            document.getElementById('res_date').innerText = new Date().toLocaleDateString('ru-RU');
            
            let rows = '';
            let total = 0;
            document.querySelectorAll('.qty-input').forEach(input => {
                const val = parseInt(input.value) || 0;
                if(val > 0) {
                    const price = parseInt(input.dataset.price);
                    const sub = val * price;
                    total += sub;
                    rows += `<tr>
                        <td style="font-weight: 700; text-transform: uppercase; font-size: 11px;">${input.dataset.name}</td>
                        <td style="text-align:center; font-weight: bold;">${val}</td>
                        <td style="text-align:right; font-weight: 900;">${sub.toLocaleString()}</td>
                    </tr>`;
                }
            });

            if(!rows) { alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—Ç!'); return; }

            document.getElementById('res_rows').innerHTML = rows;
            document.getElementById('res_total').innerText = total.toLocaleString();

            const canvas = await html2canvas(document.getElementById('invoice-paper'), { scale: 3 });
            const img = document.createElement('img');
            img.src = canvas.toDataURL("image/png");
            img.style.width = "100%";
            
            document.getElementById('image-result').innerHTML = '';
            document.getElementById('image-result').appendChild(img);
            document.getElementById('photo-overlay').style.display = 'flex';
        }

        function copyWhatsApp() {
            const client = document.getElementById('client_name').value || "–û–±—ä–µ–∫—Ç";
            let msg = `‚ö° *–°–ú–ï–¢–ê AKIM.PRO*\nüë§ –û–±—ä–µ–∫—Ç: ${client}\n--------------------------\n`;
            
            document.querySelectorAll('.qty-input').forEach(input => {
                const val = parseInt(input.value) || 0;
                if(val > 0) {
                    msg += `‚Ä¢ ${input.dataset.name}: ${val} ‚Äî ${val * input.dataset.price} —Å–æ–º\n`;
                }
            });

            msg += `--------------------------\nüí∞ *–ò–¢–û–ì–û: ${totalDisplay.innerText} –°–û–ú*\n\nüìû –ú–∞—Å—Ç–µ—Ä: +996 755 000 228`;
            
            const area = document.createElement('textarea');
            area.value = msg;
            document.body.appendChild(area);
            area.select();
            document.execCommand('copy');
            document.body.removeChild(area);
            alert('–°–º–µ—Ç–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞! –û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—ë –≤ WhatsApp.');
        }

        window.onload = init;
    </script>
    <script src="data/prices.js"></script>
    
</body>
</html>

